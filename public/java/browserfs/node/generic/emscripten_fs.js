"use strict";
var BrowserFS = require('../core/browserfs');
var fs = require('../core/node_fs');
var util_1 = require('../core/util');
var BFSEmscriptenStreamOps = (function () {
    function BFSEmscriptenStreamOps(fs) {
        this.fs = fs;
        this.nodefs = fs.getNodeFS();
        this.FS = fs.getFS();
        this.PATH = fs.getPATH();
        this.ERRNO_CODES = fs.getERRNO_CODES();
    }
    BFSEmscriptenStreamOps.prototype.open = function (stream) {
        var path = this.fs.realPath(stream.node), FS = this.FS;
        try {
            if (FS.isFile(stream.node.mode)) {
                stream.nfd = this.nodefs.openSync(path, this.fs.flagsToPermissionString(stream.flags));
            }
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    BFSEmscriptenStreamOps.prototype.close = function (stream) {
        var FS = this.FS;
        try {
            if (FS.isFile(stream.node.mode) && stream.nfd) {
                this.nodefs.closeSync(stream.nfd);
            }
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    BFSEmscriptenStreamOps.prototype.read = function (stream, buffer, offset, length, position) {
        try {
            return this.nodefs.readSync(stream.nfd, util_1.uint8Array2Buffer(buffer), offset, length, position);
        }
        catch (e) {
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    BFSEmscriptenStreamOps.prototype.write = function (stream, buffer, offset, length, position) {
        try {
            return this.nodefs.writeSync(stream.nfd, util_1.uint8Array2Buffer(buffer), offset, length, position);
        }
        catch (e) {
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    BFSEmscriptenStreamOps.prototype.llseek = function (stream, offset, whence) {
        var position = offset;
        if (whence === 1) {
            position += stream.position;
        }
        else if (whence === 2) {
            if (this.FS.isFile(stream.node.mode)) {
                try {
                    var stat = this.nodefs.fstatSync(stream.nfd);
                    position += stat.size;
                }
                catch (e) {
                    throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
                }
            }
        }
        if (position < 0) {
            throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);
        }
        stream.position = position;
        return position;
    };
    return BFSEmscriptenStreamOps;
}());
var BFSEmscriptenNodeOps = (function () {
    function BFSEmscriptenNodeOps(fs) {
        this.fs = fs;
        this.nodefs = fs.getNodeFS();
        this.FS = fs.getFS();
        this.PATH = fs.getPATH();
        this.ERRNO_CODES = fs.getERRNO_CODES();
    }
    BFSEmscriptenNodeOps.prototype.getattr = function (node) {
        var path = this.fs.realPath(node);
        var stat;
        try {
            stat = this.nodefs.lstatSync(path);
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
        return {
            dev: stat.dev,
            ino: stat.ino,
            mode: stat.mode,
            nlink: stat.nlink,
            uid: stat.uid,
            gid: stat.gid,
            rdev: stat.rdev,
            size: stat.size,
            atime: stat.atime,
            mtime: stat.mtime,
            ctime: stat.ctime,
            blksize: stat.blksize,
            blocks: stat.blocks
        };
    };
    BFSEmscriptenNodeOps.prototype.setattr = function (node, attr) {
        var path = this.fs.realPath(node);
        try {
            if (attr.mode !== undefined) {
                this.nodefs.chmodSync(path, attr.mode);
                node.mode = attr.mode;
            }
            if (attr.timestamp !== undefined) {
                var date = new Date(attr.timestamp);
                this.nodefs.utimesSync(path, date, date);
            }
        }
        catch (e) {
            if (!e.code)
                throw e;
            if (e.code !== "ENOTSUP") {
                throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
            }
        }
        if (attr.size !== undefined) {
            try {
                this.nodefs.truncateSync(path, attr.size);
            }
            catch (e) {
                if (!e.code)
                    throw e;
                throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
            }
        }
    };
    BFSEmscriptenNodeOps.prototype.lookup = function (parent, name) {
        var path = this.PATH.join2(this.fs.realPath(parent), name);
        var mode = this.fs.getMode(path);
        return this.fs.createNode(parent, name, mode);
    };
    BFSEmscriptenNodeOps.prototype.mknod = function (parent, name, mode, dev) {
        var node = this.fs.createNode(parent, name, mode, dev);
        var path = this.fs.realPath(node);
        try {
            if (this.FS.isDir(node.mode)) {
                this.nodefs.mkdirSync(path, node.mode);
            }
            else {
                this.nodefs.writeFileSync(path, '', { mode: node.mode });
            }
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
        return node;
    };
    BFSEmscriptenNodeOps.prototype.rename = function (oldNode, newDir, newName) {
        var oldPath = this.fs.realPath(oldNode);
        var newPath = this.PATH.join2(this.fs.realPath(newDir), newName);
        try {
            this.nodefs.renameSync(oldPath, newPath);
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    BFSEmscriptenNodeOps.prototype.unlink = function (parent, name) {
        var path = this.PATH.join2(this.fs.realPath(parent), name);
        try {
            this.nodefs.unlinkSync(path);
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    BFSEmscriptenNodeOps.prototype.rmdir = function (parent, name) {
        var path = this.PATH.join2(this.fs.realPath(parent), name);
        try {
            this.nodefs.rmdirSync(path);
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    BFSEmscriptenNodeOps.prototype.readdir = function (node) {
        var path = this.fs.realPath(node);
        try {
            return this.nodefs.readdirSync(path);
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    BFSEmscriptenNodeOps.prototype.symlink = function (parent, newName, oldPath) {
        var newPath = this.PATH.join2(this.fs.realPath(parent), newName);
        try {
            this.nodefs.symlinkSync(oldPath, newPath);
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    BFSEmscriptenNodeOps.prototype.readlink = function (node) {
        var path = this.fs.realPath(node);
        try {
            return this.nodefs.readlinkSync(path);
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
    };
    return BFSEmscriptenNodeOps;
}());
var BFSEmscriptenFS = (function () {
    function BFSEmscriptenFS(_FS, _PATH, _ERRNO_CODES, nodefs) {
        if (_FS === void 0) { _FS = self['FS']; }
        if (_PATH === void 0) { _PATH = self['PATH']; }
        if (_ERRNO_CODES === void 0) { _ERRNO_CODES = self['ERRNO_CODES']; }
        if (nodefs === void 0) { nodefs = fs; }
        this.flagsToPermissionStringMap = {
            0: 'r',
            1: 'r+',
            2: 'r+',
            64: 'r',
            65: 'r+',
            66: 'r+',
            129: 'rx+',
            193: 'rx+',
            514: 'w+',
            577: 'w',
            578: 'w+',
            705: 'wx',
            706: 'wx+',
            1024: 'a',
            1025: 'a',
            1026: 'a+',
            1089: 'a',
            1090: 'a+',
            1153: 'ax',
            1154: 'ax+',
            1217: 'ax',
            1218: 'ax+',
            4096: 'rs',
            4098: 'rs+'
        };
        if (typeof BrowserFS === 'undefined') {
            throw new Error("BrowserFS is not loaded. Please load it before this library.");
        }
        this.nodefs = nodefs;
        this.FS = _FS;
        this.PATH = _PATH;
        this.ERRNO_CODES = _ERRNO_CODES;
        this.node_ops = new BFSEmscriptenNodeOps(this);
        this.stream_ops = new BFSEmscriptenStreamOps(this);
    }
    BFSEmscriptenFS.prototype.mount = function (mount) {
        return this.createNode(null, '/', this.getMode(mount.opts.root), 0);
    };
    BFSEmscriptenFS.prototype.createNode = function (parent, name, mode, dev) {
        var FS = this.FS;
        if (!FS.isDir(mode) && !FS.isFile(mode) && !FS.isLink(mode)) {
            throw new FS.ErrnoError(this.ERRNO_CODES.EINVAL);
        }
        var node = FS.createNode(parent, name, mode);
        node.node_ops = this.node_ops;
        node.stream_ops = this.stream_ops;
        return node;
    };
    BFSEmscriptenFS.prototype.getMode = function (path) {
        var stat;
        try {
            stat = this.nodefs.lstatSync(path);
        }
        catch (e) {
            if (!e.code)
                throw e;
            throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code]);
        }
        return stat.mode;
    };
    BFSEmscriptenFS.prototype.realPath = function (node) {
        var parts = [];
        while (node.parent !== node) {
            parts.push(node.name);
            node = node.parent;
        }
        parts.push(node.mount.opts.root);
        parts.reverse();
        return this.PATH.join.apply(null, parts);
    };
    BFSEmscriptenFS.prototype.flagsToPermissionString = function (flags) {
        var parsedFlags = (typeof flags === "string") ? parseInt(flags, 10) : flags;
        parsedFlags &= 0x1FFF;
        if (parsedFlags in this.flagsToPermissionStringMap) {
            return this.flagsToPermissionStringMap[parsedFlags];
        }
        else {
            return flags;
        }
    };
    BFSEmscriptenFS.prototype.getNodeFS = function () {
        return this.nodefs;
    };
    BFSEmscriptenFS.prototype.getFS = function () {
        return this.FS;
    };
    BFSEmscriptenFS.prototype.getPATH = function () {
        return this.PATH;
    };
    BFSEmscriptenFS.prototype.getERRNO_CODES = function () {
        return this.ERRNO_CODES;
    };
    return BFSEmscriptenFS;
}());
exports.__esModule = true;
exports["default"] = BFSEmscriptenFS;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1zY3JpcHRlbl9mcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9nZW5lcmljL2Vtc2NyaXB0ZW5fZnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQVdBLElBQU8sU0FBUyxXQUFXLG1CQUFtQixDQUFDLENBQUM7QUFFaEQsSUFBTyxFQUFFLFdBQVcsaUJBQWlCLENBQUMsQ0FBQztBQUV2QyxxQkFBZ0MsY0FBYyxDQUFDLENBQUE7QUFpRS9DO0lBTUUsZ0NBQW9CLEVBQW1CO1FBQW5CLE9BQUUsR0FBRixFQUFFLENBQWlCO1FBQ3JDLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3pDLENBQUM7SUFFTSxxQ0FBSSxHQUFYLFVBQVksTUFBd0I7UUFDbEMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUN0QyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNmLElBQUksQ0FBQztZQUNILEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsdUJBQXVCLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDekYsQ0FBQztRQUNILENBQUU7UUFBQSxLQUFLLENBQUMs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MUIsQ0FBQztJQUlILHNCQUFDO0FBQUQsQ0FBQyxBQTlHRCxJQThHQztBQTlHRDtvQ0E4R0MsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBEZWZpbmVzIGFuIEVtc2NyaXB0ZW4gZmlsZSBzeXN0ZW0gb2JqZWN0IGZvciB1c2UgaW4gdGhlIEVtc2NyaXB0ZW4gdmlydHVhbFxyXG4gKiBmaWxlc3lzdGVtLiBBbGxvd3MgeW91IHRvIHVzZSBzeW5jaHJvbm91cyBCcm93c2VyRlMgZmlsZSBzeXN0ZW1zIGZyb20gd2l0aGluXHJcbiAqIEVtc2NyaXB0ZW4uXHJcbiAqXHJcbiAqIFlvdSBjYW4gY29uc3RydWN0IGEgQkZTRW1zY3JpcHRlbkZTLCBtb3VudCBpdCB1c2luZyBpdHMgbW91bnQgY29tbWFuZCxcclxuICogYW5kIHRoZW4gbW91bnQgaXQgaW50byBFbXNjcmlwdGVuLlxyXG4gKlxyXG4gKiBBZGFwdGVkIGZyb20gRW1zY3JpcHRlbidzIE5vZGVGUzpcclxuICogaHR0cHM6Ly9yYXcuZ2l0aHViLmNvbS9rcmlwa2VuL2Vtc2NyaXB0ZW4vbWFzdGVyL3NyYy9saWJyYXJ5X25vZGVmcy5qc1xyXG4gKi9cclxuaW1wb3J0IEJyb3dzZXJGUyA9IHJlcXVpcmUoJy4uL2NvcmUvYnJvd3NlcmZzJyk7XHJcbmltcG9ydCBGUyBmcm9tICcuLi9jb3JlL0ZTJztcclxuaW1wb3J0IGZzID0gcmVxdWlyZSgnLi4vY29yZS9ub2RlX2ZzJyk7XHJcbmltcG9ydCBOb2RlU3RhdHMgZnJvbSAnLi4vY29yZS9ub2RlX2ZzX3N0YXRzJztcclxuaW1wb3J0IHt1aW50OEFycmF5MkJ1ZmZlcn0gZnJvbSAnLi4vY29yZS91dGlsJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHMge1xyXG4gIGRldjogbnVtYmVyO1xyXG4gIGlubzogbnVtYmVyO1xyXG4gIG1vZGU6IG51bWJlcjtcclxuICBubGluazogbnVtYmVyO1xyXG4gIHVpZDogbnVtYmVyO1xyXG4gIGdpZDogbnVtYmVyO1xyXG4gIHJkZXY6IG51bWJlcjtcclxuICBzaXplOiBudW1iZXI7XHJcbiAgYmxrc2l6ZTogbnVtYmVyO1xyXG4gIGJsb2NrczogbnVtYmVyO1xyXG4gIGF0aW1lOiBEYXRlO1xyXG4gIG10aW1lOiBEYXRlO1xyXG4gIGN0aW1lOiBEYXRlO1xyXG4gIHRpbWVzdGFtcD86IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBFbXNjcmlwdGVuRlNOb2RlIHtcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgbW9kZTogbnVtYmVyO1xyXG4gIHBhcmVudDogRW1zY3JpcHRlbkZTTm9kZTtcclxuICBtb3VudDoge29wdHM6IHtyb290OiBzdHJpbmd9fTtcclxuICBzdHJlYW1fb3BzOiBFbXNjcmlwdGVuU3RyZWFtT3BzO1xyXG4gIG5vZGVfb3BzOiBFbXNjcmlwdGVuTm9kZU9wcztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBFbXNjcmlwdGVuU3RyZWFtIHtcclxuICBub2RlOiBFbXNjcmlwdGVuRlNOb2RlO1xyXG4gIG5mZDogYW55O1xyXG4gIGZsYWdzOiBzdHJpbmc7XHJcbiAgcG9zaXRpb246IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBFbXNjcmlwdGVuTm9kZU9wcyB7XHJcbiAgZ2V0YXR0cihub2RlOiBFbXNjcmlwdGVuRlNOb2RlKTogU3RhdHM7XHJcbiAgc2V0YXR0cihub2RlOiBFbXNjcmlwdGVuRlNOb2RlLCBhdHRyOiBTdGF0cyk6IHZvaWQ7XHJcbiAgbG9va3VwKHBhcmVudDogRW1zY3JpcHRlbkZTTm9kZSwgbmFtZTogc3RyaW5nKTogRW1zY3JpcHRlbkZTTm9kZTtcclxuICBta25vZChwYXJlbnQ6IEVtc2NyaXB0ZW5GU05vZGUsIG5hbWU6IHN0cmluZywgbW9kZTogbnVtYmVyLCBkZXY6IGFueSk6IEVtc2NyaXB0ZW5GU05vZGU7XHJcbiAgcmVuYW1lKG9sZE5vZGU6IEVtc2NyaXB0ZW5GU05vZGUsIG5ld0RpcjogRW1zY3JpcHRlbkZTTm9kZSwgbmV3TmFtZTogc3RyaW5nKTogdm9pZDtcclxuICB1bmxpbmsocGFyZW50OiBFbXNjcmlwdGVuRlNOb2RlLCBuYW1lOiBzdHJpbmcpOiB2b2lkO1xyXG4gIHJtZGlyKHBhcmVudDogRW1zY3JpcHRlbkZTTm9kZSwgbmFtZTogc3RyaW5nKTogdm9pZDtcclxuICByZWFkZGlyKG5vZGU6IEVtc2NyaXB0ZW5GU05vZGUpOiBzdHJpbmdbXTtcclxuICBzeW1saW5rKHBhcmVudDogRW1zY3JpcHRlbkZTTm9kZSwgbmV3TmFtZTogc3RyaW5nLCBvbGRQYXRoOiBzdHJpbmcpOiB2b2lkO1xyXG4gIHJlYWRsaW5rKG5vZGU6IEVtc2NyaXB0ZW5GU05vZGUpOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRW1zY3JpcHRlblN0cmVhbU9wcyB7XHJcbiAgb3BlbihzdHJlYW06IEVtc2NyaXB0ZW5TdHJlYW0pOiB2b2lkO1xyXG4gIGNsb3NlKHN0cmVhbTogRW1zY3JpcHRlblN0cmVhbSk6IHZvaWQ7XHJcbiAgcmVhZChzdHJlYW06IEVtc2NyaXB0ZW5TdHJlYW0sIGJ1ZmZlcjogVWludDhBcnJheSwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBwb3NpdGlvbjogbnVtYmVyKTogbnVtYmVyO1xyXG4gIHdyaXRlKHN0cmVhbTogRW1zY3JpcHRlblN0cmVhbSwgYnVmZmVyOiBVaW50OEFycmF5LCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXIpOiBudW1iZXI7XHJcbiAgbGxzZWVrKHN0cmVhbTogRW1zY3JpcHRlblN0cmVhbSwgb2Zmc2V0OiBudW1iZXIsIHdoZW5jZTogbnVtYmVyKTogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEVtc2NyaXB0ZW5GUyB7XHJcbiAgbW91bnQobW91bnQ6IHtvcHRzOiB7cm9vdDogc3RyaW5nfX0pOiBFbXNjcmlwdGVuRlNOb2RlO1xyXG4gIGNyZWF0ZU5vZGUocGFyZW50OiBFbXNjcmlwdGVuRlNOb2RlLCBuYW1lOiBzdHJpbmcsIG1vZGU6IG51bWJlciwgZGV2PzogYW55KTogRW1zY3JpcHRlbkZTTm9kZTtcclxuICBnZXRNb2RlKHBhdGg6IHN0cmluZyk6IG51bWJlcjtcclxuICByZWFsUGF0aChub2RlOiBFbXNjcmlwdGVuRlNOb2RlKTogc3RyaW5nO1xyXG4gIG5vZGVfb3BzOiBFbXNjcmlwdGVuTm9kZU9wcztcclxuICBzdHJlYW1fb3BzOiBFbXNjcmlwdGVuU3RyZWFtT3BzO1xyXG59XHJcblxyXG5jbGFzcyBCRlNFbXNjcmlwdGVuU3RyZWFtT3BzIGltcGxlbWVudHMgRW1zY3JpcHRlblN0cmVhbU9wcyB7XHJcbiAgcHJpdmF0ZSBGUzogYW55O1xyXG4gIHByaXZhdGUgUEFUSDogYW55O1xyXG4gIHByaXZhdGUgRVJSTk9fQ09ERVM6IGFueTtcclxuICBwcml2YXRlIG5vZGVmczogRlM7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZnM6IEJGU0Vtc2NyaXB0ZW5GUykge1xyXG4gICAgdGhpcy5ub2RlZnMgPSBmcy5nZXROb2RlRlMoKTtcclxuICAgIHRoaXMuRlMgPSBmcy5nZXRGUygpO1xyXG4gICAgdGhpcy5QQVRIID0gZnMuZ2V0UEFUSCgpO1xyXG4gICAgdGhpcy5FUlJOT19DT0RFUyA9IGZzLmdldEVSUk5PX0NPREVTKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3BlbihzdHJlYW06IEVtc2NyaXB0ZW5TdHJlYW0pOiB2b2lkIHtcclxuICAgIHZhciBwYXRoID0gdGhpcy5mcy5yZWFsUGF0aChzdHJlYW0ubm9kZSksXHJcbiAgICAgIEZTID0gdGhpcy5GUztcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChGUy5pc0ZpbGUoc3RyZWFtLm5vZGUubW9kZSkpIHtcclxuICAgICAgICBzdHJlYW0ubmZkID0gdGhpcy5ub2RlZnMub3BlblN5bmMocGF0aCwgdGhpcy5mcy5mbGFnc1RvUGVybWlzc2lvblN0cmluZyhzdHJlYW0uZmxhZ3MpKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBpZiAoIWUuY29kZSkgdGhyb3cgZTtcclxuICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IodGhpcy5FUlJOT19DT0RFU1tlLmNvZGVdKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBjbG9zZShzdHJlYW06IEVtc2NyaXB0ZW5TdHJlYW0pOiB2b2lkIHtcclxuICAgIHZhciBGUyA9IHRoaXMuRlM7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoRlMuaXNGaWxlKHN0cmVhbS5ub2RlLm1vZGUpICYmIHN0cmVhbS5uZmQpIHtcclxuICAgICAgICB0aGlzLm5vZGVmcy5jbG9zZVN5bmMoc3RyZWFtLm5mZCk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgaWYgKCFlLmNvZGUpIHRocm93IGU7XHJcbiAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKHRoaXMuRVJSTk9fQ09ERVNbZS5jb2RlXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVhZChzdHJlYW06IEVtc2NyaXB0ZW5TdHJlYW0sIGJ1ZmZlcjogVWludDhBcnJheSwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBwb3NpdGlvbjogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIC8vIEF2b2lkIGNvcHlpbmcgb3ZlcmhlYWQgYnkgcmVhZGluZyBkaXJlY3RseSBpbnRvIGJ1ZmZlci5cclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiB0aGlzLm5vZGVmcy5yZWFkU3luYyhzdHJlYW0ubmZkLCB1aW50OEFycmF5MkJ1ZmZlcihidWZmZXIpLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICB0aHJvdyBuZXcgdGhpcy5GUy5FcnJub0Vycm9yKHRoaXMuRVJSTk9fQ09ERVNbZS5jb2RlXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgd3JpdGUoc3RyZWFtOiBFbXNjcmlwdGVuU3RyZWFtLCBidWZmZXI6IFVpbnQ4QXJyYXksIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgcG9zaXRpb246IG51bWJlcik6IG51bWJlciB7XHJcbiAgICAvLyBBdm9pZCBjb3B5aW5nIG92ZXJoZWFkLlxyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIHRoaXMubm9kZWZzLndyaXRlU3luYyhzdHJlYW0ubmZkLCB1aW50OEFycmF5MkJ1ZmZlcihidWZmZXIpLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICB0aHJvdyBuZXcgdGhpcy5GUy5FcnJub0Vycm9yKHRoaXMuRVJSTk9fQ09ERVNbZS5jb2RlXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbGxzZWVrKHN0cmVhbTogRW1zY3JpcHRlblN0cmVhbSwgb2Zmc2V0OiBudW1iZXIsIHdoZW5jZTogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIHZhciBwb3NpdGlvbiA9IG9mZnNldDtcclxuICAgIGlmICh3aGVuY2UgPT09IDEpIHsgIC8vIFNFRUtfQ1VSLlxyXG4gICAgICBwb3NpdGlvbiArPSBzdHJlYW0ucG9zaXRpb247XHJcbiAgICB9IGVsc2UgaWYgKHdoZW5jZSA9PT0gMikgeyAgLy8gU0VFS19FTkQuXHJcbiAgICAgIGlmICh0aGlzLkZTLmlzRmlsZShzdHJlYW0ubm9kZS5tb2RlKSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICB2YXIgc3RhdCA9IHRoaXMubm9kZWZzLmZzdGF0U3luYyhzdHJlYW0ubmZkKTtcclxuICAgICAgICAgIHBvc2l0aW9uICs9IHN0YXQuc2l6ZTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgdGhpcy5GUy5FcnJub0Vycm9yKHRoaXMuRVJSTk9fQ09ERVNbZS5jb2RlXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHBvc2l0aW9uIDwgMCkge1xyXG4gICAgICB0aHJvdyBuZXcgdGhpcy5GUy5FcnJub0Vycm9yKHRoaXMuRVJSTk9fQ09ERVMuRUlOVkFMKTtcclxuICAgIH1cclxuXHJcbiAgICBzdHJlYW0ucG9zaXRpb24gPSBwb3NpdGlvbjtcclxuICAgIHJldHVybiBwb3NpdGlvbjtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIEJGU0Vtc2NyaXB0ZW5Ob2RlT3BzIGltcGxlbWVudHMgRW1zY3JpcHRlbk5vZGVPcHMge1xyXG4gIHByaXZhdGUgRlM6IGFueTtcclxuICBwcml2YXRlIFBBVEg6IGFueTtcclxuICBwcml2YXRlIEVSUk5PX0NPREVTOiBhbnk7XHJcbiAgcHJpdmF0ZSBub2RlZnM6IEZTO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGZzOiBCRlNFbXNjcmlwdGVuRlMpIHtcclxuICAgIHRoaXMubm9kZWZzID0gZnMuZ2V0Tm9kZUZTKCk7XHJcbiAgICB0aGlzLkZTID0gZnMuZ2V0RlMoKTtcclxuICAgIHRoaXMuUEFUSCA9IGZzLmdldFBBVEgoKTtcclxuICAgIHRoaXMuRVJSTk9fQ09ERVMgPSBmcy5nZXRFUlJOT19DT0RFUygpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldGF0dHIobm9kZTogRW1zY3JpcHRlbkZTTm9kZSk6IFN0YXRzIHtcclxuICAgIHZhciBwYXRoID0gdGhpcy5mcy5yZWFsUGF0aChub2RlKTtcclxuICAgIHZhciBzdGF0OiBOb2RlU3RhdHM7XHJcbiAgICB0cnkge1xyXG4gICAgICBzdGF0ID0gdGhpcy5ub2RlZnMubHN0YXRTeW5jKHBhdGgpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBpZiAoIWUuY29kZSkgdGhyb3cgZTtcclxuICAgICAgdGhyb3cgbmV3IHRoaXMuRlMuRXJybm9FcnJvcih0aGlzLkVSUk5PX0NPREVTW2UuY29kZV0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZGV2OiBzdGF0LmRldixcclxuICAgICAgaW5vOiBzdGF0LmlubyxcclxuICAgICAgbW9kZTogc3RhdC5tb2RlLFxyXG4gICAgICBubGluazogc3RhdC5ubGluayxcclxuICAgICAgdWlkOiBzdGF0LnVpZCxcclxuICAgICAgZ2lkOiBzdGF0LmdpZCxcclxuICAgICAgcmRldjogc3RhdC5yZGV2LFxyXG4gICAgICBzaXplOiBzdGF0LnNpemUsXHJcbiAgICAgIGF0aW1lOiBzdGF0LmF0aW1lLFxyXG4gICAgICBtdGltZTogc3RhdC5tdGltZSxcclxuICAgICAgY3RpbWU6IHN0YXQuY3RpbWUsXHJcbiAgICAgIGJsa3NpemU6IHN0YXQuYmxrc2l6ZSxcclxuICAgICAgYmxvY2tzOiBzdGF0LmJsb2Nrc1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRhdHRyKG5vZGU6IEVtc2NyaXB0ZW5GU05vZGUsIGF0dHI6IFN0YXRzKTogdm9pZCB7XHJcbiAgICB2YXIgcGF0aCA9IHRoaXMuZnMucmVhbFBhdGgobm9kZSk7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoYXR0ci5tb2RlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aGlzLm5vZGVmcy5jaG1vZFN5bmMocGF0aCwgYXR0ci5tb2RlKTtcclxuICAgICAgICAvLyB1cGRhdGUgdGhlIGNvbW1vbiBub2RlIHN0cnVjdHVyZSBtb2RlIGFzIHdlbGxcclxuICAgICAgICBub2RlLm1vZGUgPSBhdHRyLm1vZGU7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGF0dHIudGltZXN0YW1wICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGF0dHIudGltZXN0YW1wKTtcclxuICAgICAgICB0aGlzLm5vZGVmcy51dGltZXNTeW5jKHBhdGgsIGRhdGUsIGRhdGUpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlO1xyXG4gICAgICAvLyBJZ25vcmUgbm90IHN1cHBvcnRlZCBlcnJvcnMuIEVtc2NyaXB0ZW4gZG9lcyB1dGltZXNTeW5jIHdoZW4gaXRcclxuICAgICAgLy8gd3JpdGVzIGZpbGVzLCBidXQgbmV2ZXIgcmVhbGx5IHJlcXVpcmVzIHRoZSB2YWx1ZSB0byBiZSBzZXQuXHJcbiAgICAgIGlmIChlLmNvZGUgIT09IFwiRU5PVFNVUFwiKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IHRoaXMuRlMuRXJybm9FcnJvcih0aGlzLkVSUk5PX0NPREVTW2UuY29kZV0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoYXR0ci5zaXplICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICB0aGlzLm5vZGVmcy50cnVuY2F0ZVN5bmMocGF0aCwgYXR0ci5zaXplKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlO1xyXG4gICAgICAgIHRocm93IG5ldyB0aGlzLkZTLkVycm5vRXJyb3IodGhpcy5FUlJOT19DT0RFU1tlLmNvZGVdKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGxvb2t1cChwYXJlbnQ6IEVtc2NyaXB0ZW5GU05vZGUsIG5hbWU6IHN0cmluZyk6IEVtc2NyaXB0ZW5GU05vZGUge1xyXG4gICAgdmFyIHBhdGggPSB0aGlzLlBBVEguam9pbjIodGhpcy5mcy5yZWFsUGF0aChwYXJlbnQpLCBuYW1lKTtcclxuICAgIHZhciBtb2RlID0gdGhpcy5mcy5nZXRNb2RlKHBhdGgpO1xyXG4gICAgcmV0dXJuIHRoaXMuZnMuY3JlYXRlTm9kZShwYXJlbnQsIG5hbWUsIG1vZGUpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG1rbm9kKHBhcmVudDogRW1zY3JpcHRlbkZTTm9kZSwgbmFtZTogc3RyaW5nLCBtb2RlOiBudW1iZXIsIGRldjogYW55KTogRW1zY3JpcHRlbkZTTm9kZSB7XHJcbiAgICB2YXIgbm9kZSA9IHRoaXMuZnMuY3JlYXRlTm9kZShwYXJlbnQsIG5hbWUsIG1vZGUsIGRldik7XHJcbiAgICAvLyBjcmVhdGUgdGhlIGJhY2tpbmcgbm9kZSBmb3IgdGhpcyBpbiB0aGUgZnMgcm9vdCBhcyB3ZWxsXHJcbiAgICB2YXIgcGF0aCA9IHRoaXMuZnMucmVhbFBhdGgobm9kZSk7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAodGhpcy5GUy5pc0Rpcihub2RlLm1vZGUpKSB7XHJcbiAgICAgICAgdGhpcy5ub2RlZnMubWtkaXJTeW5jKHBhdGgsIG5vZGUubW9kZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5ub2RlZnMud3JpdGVGaWxlU3luYyhwYXRoLCAnJywgeyBtb2RlOiBub2RlLm1vZGUgfSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgaWYgKCFlLmNvZGUpIHRocm93IGU7XHJcbiAgICAgIHRocm93IG5ldyB0aGlzLkZTLkVycm5vRXJyb3IodGhpcy5FUlJOT19DT0RFU1tlLmNvZGVdKTtcclxuICAgIH1cclxuICAgIHJldHVybiBub2RlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlbmFtZShvbGROb2RlOiBFbXNjcmlwdGVuRlNOb2RlLCBuZXdEaXI6IEVtc2NyaXB0ZW5GU05vZGUsIG5ld05hbWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdmFyIG9sZFBhdGggPSB0aGlzLmZzLnJlYWxQYXRoKG9sZE5vZGUpO1xyXG4gICAgdmFyIG5ld1BhdGggPSB0aGlzLlBBVEguam9pbjIodGhpcy5mcy5yZWFsUGF0aChuZXdEaXIpLCBuZXdOYW1lKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRoaXMubm9kZWZzLnJlbmFtZVN5bmMob2xkUGF0aCwgbmV3UGF0aCk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlO1xyXG4gICAgICB0aHJvdyBuZXcgdGhpcy5GUy5FcnJub0Vycm9yKHRoaXMuRVJSTk9fQ09ERVNbZS5jb2RlXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdW5saW5rKHBhcmVudDogRW1zY3JpcHRlbkZTTm9kZSwgbmFtZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB2YXIgcGF0aCA9IHRoaXMuUEFUSC5qb2luMih0aGlzLmZzLnJlYWxQYXRoKHBhcmVudCksIG5hbWUpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgdGhpcy5ub2RlZnMudW5saW5rU3luYyhwYXRoKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgaWYgKCFlLmNvZGUpIHRocm93IGU7XHJcbiAgICAgIHRocm93IG5ldyB0aGlzLkZTLkVycm5vRXJyb3IodGhpcy5FUlJOT19DT0RFU1tlLmNvZGVdKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBybWRpcihwYXJlbnQ6IEVtc2NyaXB0ZW5GU05vZGUsIG5hbWU6IHN0cmluZykge1xyXG4gICAgdmFyIHBhdGggPSB0aGlzLlBBVEguam9pbjIodGhpcy5mcy5yZWFsUGF0aChwYXJlbnQpLCBuYW1lKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRoaXMubm9kZWZzLnJtZGlyU3luYyhwYXRoKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgaWYgKCFlLmNvZGUpIHRocm93IGU7XHJcbiAgICAgIHRocm93IG5ldyB0aGlzLkZTLkVycm5vRXJyb3IodGhpcy5FUlJOT19DT0RFU1tlLmNvZGVdKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyByZWFkZGlyKG5vZGU6IEVtc2NyaXB0ZW5GU05vZGUpOiBzdHJpbmdbXSB7XHJcbiAgICB2YXIgcGF0aCA9IHRoaXMuZnMucmVhbFBhdGgobm9kZSk7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gdGhpcy5ub2RlZnMucmVhZGRpclN5bmMocGF0aCk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlO1xyXG4gICAgICB0aHJvdyBuZXcgdGhpcy5GUy5FcnJub0Vycm9yKHRoaXMuRVJSTk9fQ09ERVNbZS5jb2RlXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3ltbGluayhwYXJlbnQ6IEVtc2NyaXB0ZW5GU05vZGUsIG5ld05hbWU6IHN0cmluZywgb2xkUGF0aDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB2YXIgbmV3UGF0aCA9IHRoaXMuUEFUSC5qb2luMih0aGlzLmZzLnJlYWxQYXRoKHBhcmVudCksIG5ld05hbWUpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgdGhpcy5ub2RlZnMuc3ltbGlua1N5bmMob2xkUGF0aCwgbmV3UGF0aCk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlO1xyXG4gICAgICB0aHJvdyBuZXcgdGhpcy5GUy5FcnJub0Vycm9yKHRoaXMuRVJSTk9fQ09ERVNbZS5jb2RlXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVhZGxpbmsobm9kZTogRW1zY3JpcHRlbkZTTm9kZSk6IHN0cmluZyB7XHJcbiAgICB2YXIgcGF0aCA9IHRoaXMuZnMucmVhbFBhdGgobm9kZSk7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gdGhpcy5ub2RlZnMucmVhZGxpbmtTeW5jKHBhdGgpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBpZiAoIWUuY29kZSkgdGhyb3cgZTtcclxuICAgICAgdGhyb3cgbmV3IHRoaXMuRlMuRXJybm9FcnJvcih0aGlzLkVSUk5PX0NPREVTW2UuY29kZV0pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQkZTRW1zY3JpcHRlbkZTIGltcGxlbWVudHMgRW1zY3JpcHRlbkZTIHtcclxuICBwcml2YXRlIEZTOiBhbnk7XHJcbiAgcHJpdmF0ZSBQQVRIOiBhbnk7XHJcbiAgcHJpdmF0ZSBFUlJOT19DT0RFUzogYW55O1xyXG4gIHByaXZhdGUgbm9kZWZzOiBGUztcclxuICBjb25zdHJ1Y3RvcihfRlMgPSAoPGFueT4gc2VsZilbJ0ZTJ10sIF9QQVRIID0gKDxhbnk+IHNlbGYpWydQQVRIJ10sIF9FUlJOT19DT0RFUyA9ICg8YW55PiBzZWxmKVsnRVJSTk9fQ09ERVMnXSwgbm9kZWZzOiBGUyA9IGZzKSB7XHJcbiAgICBpZiAodHlwZW9mIEJyb3dzZXJGUyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQnJvd3NlckZTIGlzIG5vdCBsb2FkZWQuIFBsZWFzZSBsb2FkIGl0IGJlZm9yZSB0aGlzIGxpYnJhcnkuXCIpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5ub2RlZnMgPSBub2RlZnM7XHJcbiAgICB0aGlzLkZTID0gX0ZTO1xyXG4gICAgdGhpcy5QQVRIID0gX1BBVEg7XHJcbiAgICB0aGlzLkVSUk5PX0NPREVTID0gX0VSUk5PX0NPREVTO1xyXG4gICAgdGhpcy5ub2RlX29wcyA9IG5ldyBCRlNFbXNjcmlwdGVuTm9kZU9wcyh0aGlzKTtcclxuICAgIHRoaXMuc3RyZWFtX29wcyA9IG5ldyBCRlNFbXNjcmlwdGVuU3RyZWFtT3BzKHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG1vdW50KG1vdW50OiB7b3B0czoge3Jvb3Q6IHN0cmluZ319KTogRW1zY3JpcHRlbkZTTm9kZSB7XHJcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVOb2RlKG51bGwsICcvJywgdGhpcy5nZXRNb2RlKG1vdW50Lm9wdHMucm9vdCksIDApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNyZWF0ZU5vZGUocGFyZW50OiBFbXNjcmlwdGVuRlNOb2RlLCBuYW1lOiBzdHJpbmcsIG1vZGU6IG51bWJlciwgZGV2PzogYW55KTogRW1zY3JpcHRlbkZTTm9kZSB7XHJcbiAgICB2YXIgRlMgPSB0aGlzLkZTO1xyXG4gICAgaWYgKCFGUy5pc0Rpcihtb2RlKSAmJiAhRlMuaXNGaWxlKG1vZGUpICYmICFGUy5pc0xpbmsobW9kZSkpIHtcclxuICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IodGhpcy5FUlJOT19DT0RFUy5FSU5WQUwpO1xyXG4gICAgfVxyXG4gICAgdmFyIG5vZGUgPSBGUy5jcmVhdGVOb2RlKHBhcmVudCwgbmFtZSwgbW9kZSk7XHJcbiAgICBub2RlLm5vZGVfb3BzID0gdGhpcy5ub2RlX29wcztcclxuICAgIG5vZGUuc3RyZWFtX29wcyA9IHRoaXMuc3RyZWFtX29wcztcclxuICAgIHJldHVybiBub2RlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldE1vZGUocGF0aDogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgIHZhciBzdGF0OiBOb2RlU3RhdHM7XHJcbiAgICB0cnkge1xyXG4gICAgICBzdGF0ID0gdGhpcy5ub2RlZnMubHN0YXRTeW5jKHBhdGgpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBpZiAoIWUuY29kZSkgdGhyb3cgZTtcclxuICAgICAgdGhyb3cgbmV3IHRoaXMuRlMuRXJybm9FcnJvcih0aGlzLkVSUk5PX0NPREVTW2UuY29kZV0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0YXQubW9kZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZWFsUGF0aChub2RlOiBFbXNjcmlwdGVuRlNOb2RlKTogc3RyaW5nIHtcclxuICAgIHZhciBwYXJ0czogc3RyaW5nW10gPSBbXTtcclxuICAgIHdoaWxlIChub2RlLnBhcmVudCAhPT0gbm9kZSkge1xyXG4gICAgICBwYXJ0cy5wdXNoKG5vZGUubmFtZSk7XHJcbiAgICAgIG5vZGUgPSBub2RlLnBhcmVudDtcclxuICAgIH1cclxuICAgIHBhcnRzLnB1c2gobm9kZS5tb3VudC5vcHRzLnJvb3QpO1xyXG4gICAgcGFydHMucmV2ZXJzZSgpO1xyXG4gICAgcmV0dXJuIHRoaXMuUEFUSC5qb2luLmFwcGx5KG51bGwsIHBhcnRzKTtcclxuICB9XHJcbiAgLy8gVGhpcyBtYXBzIHRoZSBpbnRlZ2VyIHBlcm1pc3Npb24gbW9kZXMgZnJvbSBodHRwOi8vbGludXguZGllLm5ldC9tYW4vMy9vcGVuXHJcbiAgLy8gdG8gbm9kZS5qcy1zcGVjaWZpYyBmaWxlIG9wZW4gcGVybWlzc2lvbiBzdHJpbmdzIGF0IGh0dHA6Ly9ub2RlanMub3JnL2FwaS9mcy5odG1sI2ZzX2ZzX29wZW5fcGF0aF9mbGFnc19tb2RlX2NhbGxiYWNrXHJcbiAgcHVibGljIGZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nTWFwID0ge1xyXG4gICAgMC8qT19SRE9OTFkqLzogJ3InLFxyXG4gICAgMS8qT19XUk9OTFkqLzogJ3IrJyxcclxuICAgIDIvKk9fUkRXUiovOiAncisnLFxyXG4gICAgNjQvKk9fQ1JFQVQqLzogJ3InLFxyXG4gICAgNjUvKk9fV1JPTkxZfE9fQ1JFQVQqLzogJ3IrJyxcclxuICAgIDY2LypPX1JEV1J8T19DUkVBVCovOiAncisnLFxyXG4gICAgMTI5LypPX1dST05MWXxPX0VYQ0wqLzogJ3J4KycsXHJcbiAgICAxOTMvKk9fV1JPTkxZfE9fQ1JFQVR8T19FWENMKi86ICdyeCsnLFxyXG4gICAgNTE0LypPX1JEV1J8T19UUlVOQyovOiAndysnLFxyXG4gICAgNTc3LypPX1dST05MWXxPX0NSRUFUfE9fVFJVTkMqLzogJ3cnLFxyXG4gICAgNTc4LypPX0NSRUFUfE9fUkRXUnxPX1RSVU5DKi86ICd3KycsXHJcbiAgICA3MDUvKk9fV1JPTkxZfE9fQ1JFQVR8T19FWENMfE9fVFJVTkMqLzogJ3d4JyxcclxuICAgIDcwNi8qT19SRFdSfE9fQ1JFQVR8T19FWENMfE9fVFJVTkMqLzogJ3d4KycsXHJcbiAgICAxMDI0LypPX0FQUEVORCovOiAnYScsXHJcbiAgICAxMDI1LypPX1dST05MWXxPX0FQUEVORCovOiAnYScsXHJcbiAgICAxMDI2LypPX1JEV1J8T19BUFBFTkQqLzogJ2ErJyxcclxuICAgIDEwODkvKk9fV1JPTkxZfE9fQ1JFQVR8T19BUFBFTkQqLzogJ2EnLFxyXG4gICAgMTA5MC8qT19SRFdSfE9fQ1JFQVR8T19BUFBFTkQqLzogJ2ErJyxcclxuICAgIDExNTMvKk9fV1JPTkxZfE9fRVhDTHxPX0FQUEVORCovOiAnYXgnLFxyXG4gICAgMTE1NC8qT19SRFdSfE9fRVhDTHxPX0FQUEVORCovOiAnYXgrJyxcclxuICAgIDEyMTcvKk9fV1JPTkxZfE9fQ1JFQVR8T19FWENMfE9fQVBQRU5EKi86ICdheCcsXHJcbiAgICAxMjE4LypPX1JEV1J8T19DUkVBVHxPX0VYQ0x8T19BUFBFTkQqLzogJ2F4KycsXHJcbiAgICA0MDk2LypPX1JET05MWXxPX0RTWU5DKi86ICdycycsXHJcbiAgICA0MDk4LypPX1JEV1J8T19EU1lOQyovOiAncnMrJ1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nKGZsYWdzOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgdmFyIHBhcnNlZEZsYWdzID0gKHR5cGVvZiBmbGFncyA9PT0gXCJzdHJpbmdcIikgPyBwYXJzZUludChmbGFncywgMTApIDogPG51bWJlcj48YW55PiBmbGFncztcclxuICAgIHBhcnNlZEZsYWdzICY9IDB4MUZGRjtcclxuICAgIGlmIChwYXJzZWRGbGFncyBpbiB0aGlzLmZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nTWFwKSB7XHJcbiAgICAgIHJldHVybiAoPGFueT4gdGhpcy5mbGFnc1RvUGVybWlzc2lvblN0cmluZ01hcClbcGFyc2VkRmxhZ3NdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIGZsYWdzO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldE5vZGVGUygpIHtcclxuICAgIHJldHVybiB0aGlzLm5vZGVmcztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRGUygpIHtcclxuICAgIHJldHVybiB0aGlzLkZTO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFBBVEgoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5QQVRIO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEVSUk5PX0NPREVTKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuRVJSTk9fQ09ERVM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbm9kZV9vcHM6IEVtc2NyaXB0ZW5Ob2RlT3BzO1xyXG4gIHB1YmxpYyBzdHJlYW1fb3BzOiBFbXNjcmlwdGVuU3RyZWFtT3BzO1xyXG59XHJcbiJdfQ==